# Laravel Product Filter API

Тестовое задание

## Требования

- PHP 8.2 или выше
- Composer
- Node.js и NPM
- MySQL или SQLite

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/alexlundin/laravel-test-api.git
cd laravel-test-api
```

2. Установите зависимости PHP:
```bash
composer install
```

3. Установите зависимости JavaScript:
```bash
npm install
```

4. Скопируйте файл окружения:
```bash
cp .env.example .env
```

5. Сгенерируйте ключ приложения:
```bash
php artisan key:generate
```

6. Настройте подключение к базе данных в файле `.env`:
```
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel_product_filter
DB_USERNAME=root
DB_PASSWORD=
```

Или для SQLite:
```
DB_CONNECTION=sqlite
```
И создайте файл базы данных:
```bash
touch database/database.sqlite
```

7. Запустите миграции и заполните базу данных тестовыми данными:
```bash
php artisan migrate --seed
```

8. Скомпилируйте ресурсы фронтенда:
```bash
npm run build
```

9. Запустите сервер разработки:
```bash
php artisan serve
```

Приложение будет доступно по адресу: http://localhost:8000

## Запуск с использованием встроенного скрипта

Для одновременного запуска сервера, очереди и компиляции фронтенда используйте команду:
```bash
composer run dev
```

## Использование API фильтрации продуктов

### Базовый эндпоинт

```
GET /api/products
```

### Формат ответа

API возвращает данные в формате JSON. Опции продукта представлены в формате строк "Категория: Значение", например:

```json
{
  "data": [
    {
      "id": 1,
      "name": "Люстра Colosseo",
      "description": "Описание люстры",
      "price": 1500,
      "options": [
        "Страна: Италия",
        "Цвет плафона: Белый",
        "Материал: Металл"
      ],
      "created_at": "2023-05-10T12:00:00.000000Z",
      "updated_at": "2023-05-10T12:00:00.000000Z"
    }
  ],
  "links": {...},
  "meta": {...}
}
```

### Параметры фильтрации

| Параметр | Описание | Пример |
|----------|----------|--------|
| `price_min` | Минимальная цена | `?price_min=1000` |
| `price_max` | Максимальная цена | `?price_max=2000` |
| `search` | Поиск по названию и описанию | `?search=Люстра` |
| `sort` | Поле для сортировки (name, price, created_at) | `?sort=price` |
| `direction` | Направление сортировки (asc, desc) | `?direction=asc` |
| `page` | Номер страницы для пагинации | `?page=2` |
| `per_page` | Количество элементов на странице | `?per_page=20` |
| `[option_name]` | Фильтр по опциям (поддерживает множественные значения через запятую) | `?цвет_плафона=Белый,Черный` |

### Примеры запросов

1. Фильтр по цене:
```
/api/products?price_min=1000&price_max=2000
```

2. Поиск по названию:
```
/api/products?search=Люстра Colosseo
```

3. Сортировка по цене (по возрастанию):
```
/api/products?sort=price&direction=asc
```

4. Фильтр по опциям (страна и цвет плафона):
```
/api/products?страна=Россия,Китай&цвет_плафона=Белый
```

5. Пагинация:
```
/api/products?page=2&per_page=20
```

6. Комбинированные фильтры:
```
/api/products?price_min=1000&price_max=2000&страна=Италия&цвет_арматуры=Золотой&sort=price&direction=desc&page=1&per_page=10
```

7. Фильтр по количеству ламп:
```
/api/products?количество_ламп=3,4
```

8. Фильтр по материалу:
```
/api/products?материал=Металл,Стекло
```

9. Фильтр по стилю:
```
/api/products?стиль=Современный,Лофт
```

## Структура проекта

Основные файлы, относящиеся к функциональности фильтрации:

- `app/Http/Controllers/ProductController.php` - контроллер с логикой фильтрации
- `app/Models/Product.php` - модель продукта
- `app/Models/OptionCategory.php` - модель категории опций (цвет, размер и т.д.)
- `app/Models/OptionValue.php` - модель значений опций (красный, синий, большой и т.д.)
- `app/Http/Resources/ProductResource.php` - ресурс для форматирования ответа API
- `database/migrations/` - миграции для создания таблиц
- `database/seeders/` - сидеры для заполнения базы тестовыми данными

## Тестирование

Для запуска тестов используйте:
```bash
php artisan test
```

## Стиль кода

Для проверки стиля кода с помощью Laravel Pint:
```bash
./vendor/bin/pint
```

## Последние обновления

- Изменен формат ответа API для опций продуктов: теперь они представлены в виде строк "Категория: Значение" вместо объектов JSON
- Добавлена поддержка множественных значений в фильтрах (например, можно выбрать несколько стран)
- Улучшена обработка параметров с пробелами в названиях категорий
- Добавлена защита от ошибок при обработке некорректных данных

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности в файле [LICENSE](LICENSE).
